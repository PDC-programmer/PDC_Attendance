<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leave Request</title>
    <script src="https://static.line-scdn.net/liff/2/sdk.js"></script>
</head>
<body>
    <h1>Request Leave</h1>
    <form method="post" id="leaveForm">
        {% csrf_token %}
        <input type="hidden" id="uid" name="uid">
        {{ form.as_p }}
        <button type="button" id="loginButton">Login with LINE</button>
        <button type="submit" style="display:none;" id="submitButton">Submit Leave Request</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize LIFF SDK
            liff.init({ liffId: "2006738049-wq86x5Xl" }).then(() => {
                document.getElementById('loginButton').addEventListener('click', function () {
                    liff.login();
                });

                // Check if user is logged in
                if (liff.isLoggedIn()) {
                    liff.getProfile().then(profile => {
                        document.getElementById('uid').value = profile.userId; // Set userId from LINE Profile
                        document.getElementById('submitButton').style.display = 'block'; // Show Submit Button
                        document.getElementById('loginButton').style.display = 'none'; // Hide Login Button
                    }).catch(err => console.error('Error fetching profile: ', err));
                }
            }).catch(err => console.error('Error initializing LIFF: ', err));
        });
    </script>
</body>
</html>
